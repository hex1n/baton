# Baton v2.1

**Plan-first workflow for AI-assisted development.**

Baton enforces a structured workflow — research → plan → annotate → approve → slice → implement → verify → review — so AI coding agents produce reliable, auditable results.

## Architecture

```
Layer 0: Standalone skills (always available, zero setup)
Layer 1: Task workflow (baton new-task, adds phase-lock + gates)
Layer 2: Project governance (baton init, adds constraints + regression)
```

Each layer adds structure without breaking the one below it.

## Quick Start

```bash
# Install globally
baton install
export PATH="$HOME/.baton/bin:$PATH"

# Initialize in a project
cd your-project
baton init

# Start a task
baton new-task fix-auth-bug
baton next                    # Shows what to do next
```

## Skills

| Skill                | Phase        | Purpose                                     |
|----------------------|--------------|---------------------------------------------|
| plan-first-research  | research     | Deep-read code before planning              |
| plan-first-plan      | plan/approved| Design solution + generate todo checklist    |
| annotation-cycle     | annotation   | Process human annotations on the plan        |
| context-slice        | slice        | Generate per-item context packages           |
| plan-first-implement | implement    | Execute todo items mechanically              |
| verification-gate    | verify       | Run build/test/lint and record evidence      |
| code-reviewer        | review       | Review changes against plan + constraints    |
| using-baton          | (meta)       | Orchestrate: determine which skill to load   |

## v2.1 Key Improvements

- **Workflow Protocol**: Single source of truth (`workflow-protocol.md`) for all inter-skill relationships
- **9-phase state machine**: Added approved, slice, review phases to `detect_phase`
- **Responsibility deconfliction**: Todo generation is solely plan-first-plan's job
- **Layer 0 independence**: Standalone skills never block on missing workflow artifacts
- **Blocking scope checks**: Slice scope violations are blocking by default (was advisory)
- **Action-oriented session start**: Concrete `cat` command instead of skill mapping table

See [CHANGELOG.md](CHANGELOG.md) for full details.

## CLI Commands

```
Global:
    baton install          Install/update global layer to ~/.baton/
    baton version          Show version

Project:
    baton init             Initialize project layer (Layer 2)
    baton doctor           Health check
    baton new-task <id>    Create task scaffold (--quick for fast path)
    baton active [<id>]    Show/switch active task (--clear to unset)
    baton next             Show the next step for the active task
    baton abandon <id>     Mark task as abandoned
    baton reset-task <id>  Reset task to fresh state
    baton generate         Generate platform files (AGENTS.md, etc.)
    baton constraints      Show hard constraints status

Layer 0 (standalone):
    baton research <scope>    Deep-read code
    baton plan                Design solution
    baton annotate <file>     Process annotations
    baton slice <file>        Generate context slices
    baton implement <file>    Execute approved plan
    baton verify              Run verification
    baton review [--diff]     Review changes
```

## Supported Platforms

- **Claude Code**: Full support via SessionStart hook + PreToolUse phase-lock
- **Cursor**: Self-enforcement via `.cursor/rules/baton.md` (generated by `baton generate`)
- **Codex / OpenCode**: Via bootstrap scripts (see `hooks/`)

## File Structure

```
~/.baton/                     # Global layer (baton install)
  bin/baton                   # CLI
  skills/                     # 8 skill files
  hooks/                      # session-start.sh, phase-lock.sh
  workflow-protocol.md        # v2.1: single source of truth
  prompts/                    # Subagent prompt templates

<project>/.baton/             # Project layer (baton init)
  project-config.json         # Build/test/lint commands
  governance/
    hard-constraints.md       # Non-negotiable rules
  review-checklists.md        # Project-specific review items
  tasks/                      # Task artifacts
    <task-id>/
      research.md             # Research findings
      plan.md                 # Design + todo + slices
      verification.md         # Test evidence
      review.md               # Code review findings
```

## License

MIT
