name: CI

on:
  push:
    branches: [master]
  pull_request:
    branches: [master]

jobs:
  shellcheck:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Install shellcheck
        run: sudo apt-get install -y shellcheck
      - name: Lint write-lock.sh
        run: shellcheck .baton/write-lock.sh
      - name: Lint phase-guide.sh
        run: shellcheck .baton/phase-guide.sh
      - name: Lint bash-guard.sh
        run: shellcheck .baton/bash-guard.sh
      - name: Lint stop-guard.sh
        run: shellcheck .baton/stop-guard.sh
      - name: Lint adapters
        run: shellcheck .baton/adapters/adapter-cline.sh .baton/adapters/adapter-windsurf.sh
      - name: Lint setup.sh
        run: shellcheck setup.sh

  test-write-lock:
    strategy:
      matrix:
        os: [ubuntu-latest, macos-latest]
    runs-on: ${{ matrix.os }}
    steps:
      - uses: actions/checkout@v4
      - name: Run write-lock tests
        run: bash tests/test-write-lock.sh

  test-phase-guide:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Run phase-guide tests
        run: bash tests/test-phase-guide.sh

  test-setup:
    strategy:
      matrix:
        os: [ubuntu-latest, macos-latest]
    runs-on: ${{ matrix.os }}
    steps:
      - uses: actions/checkout@v4
      - name: Run setup tests
        run: bash tests/test-setup.sh

  test-stop-guard:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Run stop-guard tests
        run: bash tests/test-stop-guard.sh

  test-adapters:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Run adapter tests
        run: bash tests/test-adapters.sh

  test-workflow-consistency:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Check workflow consistency
        run: sh tests/test-workflow-consistency.sh
